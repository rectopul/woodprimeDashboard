const URL="http://woodprime.herokuapp.com/";function update(e,t){var n=document.querySelector(".barload");t&&"dark"==t?n.classList.add("dark"):n.classList.remove("dark");var o=1;if("function"==typeof e){o=33;var r=setInterval(a,14);function a(){o>=100?(o=1,n.style.width="0%",e(),clearInterval(r)):(o++,n.style.width=o+"%")}}if("number"==typeof e&&2===e){o=33;r=setInterval(a,14);function a(){if(65===o)return clearInterval(r);o++,n.style.width=o+"%"}}if("number"==typeof e&&1===e){o=1;r=setInterval(a,7);function a(){if(33===o)return clearInterval(r);o++,n.style.width=o+"%"}}}const animateCSS=async(e,t,n="animate__")=>new Promise((o,r)=>{const a=`${n}${t}`,i=e;i.classList.add(`${n}animated`,a),i.addEventListener("animationend",function e(){i.classList.remove(`${n}animated`,a),i.removeEventListener("animationend",e),o("Animation ended")})});$(document).ready(function(){$(".dropdown-toggle").dropdown()});const btnInsertCustom=document.querySelector(".btn-insert-custom"),custonResource="custon",createCardCustom=e=>{const t=document.createElement("div"),{id:n,name:o,description:r,type:a}=e;return t.classList.add("col-3",`card-custom-${n}`),t.dataset.category=`type-${a}`,t.dataset.id=n,t.innerHTML=`\n    <div class="card border-primary mb-3 cardCustom" data-id="${n}">\n        <div class="card-header">${o}</div>\n        <div class="card-body text-primary">\n            <p class="card-text">${r}</p>\n        </div>\n    </div>`,t},clickCard=e=>e.addEventListener("click",t=>(t.preventDefault(),$("#options").modal("show"),document.querySelector(".optionsContainer").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".modal.options .modal-title").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".modal.formOptions .modal-title").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".insertOption").dataset.option=e.dataset.id,showOptions(e.dataset.id))),insertCardCustom=e=>{const{id:t,name:n,description:o,type:r}=e,a=createCardCustom(e);document.querySelector(".container-types").prepend(a);const i=document.querySelector(".pillcustoms"),s=parseInt(i.innerHTML);return i.innerHTML=s+1,clickCard(a)};btnInsertCustom.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector(".typeCustom"),n=document.querySelector(".nameCustom"),o=document.querySelector(".descCustom");return n.value?o.value?t.value?(console.log("cliquei no custom"),document.querySelector(".loaderInsertCustom").classList.add("show"),update(1,"dark"),void fetch(`${URL}/api/custon`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:n.value,description:o.value,type_id:t.value})}).then(e=>e.json()).then(e=>{update(()=>(Swal.fire({title:`Customização ${e.name} cadastrada`,icon:"success",showCloseButton:!0}),document.querySelector(".btn-modal-types").classList.remove("btn-success"),document.querySelector(".btn-modal-types").classList.add("btn-primary"),document.querySelector(".btn-modal-types").innerHTML="Tipos de customização",console.log(t.value),insertCardCustom({name:e.name,description:e.description,id:e.id,type:t.value}),t.value="",n.value="",o.value="",document.querySelector(".loaderInsertCustom").classList.remove("show")),"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))):(t.setCustomValidity("Selecione o tipo de customização"),t.reportValidity()):(o.setCustomValidity("Informe uma descrição para a customização"),o.reportValidity()):(n.setCustomValidity("Informe o nome da customização"),n.reportValidity())});const cardCustom=document.querySelectorAll(".cardCustom");Array.from(cardCustom).forEach(e=>{clickCard(e)});const openFormOption=document.querySelector(".insertOption");openFormOption.addEventListener("click",function(e){e.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")})});const controller=new AbortController,signal=controller.signal,indexCustom=()=>{fetch(`${URL}/api/custon`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},findCustoms=e=>{fetch(`${URL}/api/custon/search/${e}`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},searchCustom=()=>{const e=document.querySelector(".search-custom"),t=document.querySelector(".customSearchButton"),n=document.querySelector(".formSearchCustom");t.addEventListener("click",function(t){t.preventDefault();const n=e.value;return n.length<3?(update(1,"dark"),void fetch(`${URL}/api/custon`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})):n.length>3?(update(1,"dark"),findCustoms(n)):void 0}),n.addEventListener("submit",function(t){t.preventDefault();const n=e.value;if(n.length>3)return update(1,"dark"),findCustoms(n)})};searchCustom();const filter=()=>{const e=document.querySelectorAll(".filtersCustom > a");Array.from(e).forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const n=e.dataset.filter,o=document.querySelectorAll(".container-types > div");document.querySelectorAll(`.container-types > div[data-category="${n}"]`);if("type-all"==n)return Array.from(o).forEach(e=>{e.classList.remove("hide")}),Array.from(o).forEach(e=>animateCSS(e,"fadeIn"));let r=[],a=[];Array.from(o).forEach(e=>{return e.dataset.category!=n?a.push(e):r.push(e)}),async function(){await Array.from(a).forEach(async e=>await animateCSS(e,"bounceOut").then(()=>e.classList.add("hide"))),await Array.from(r).forEach(async e=>(e.classList.remove("hide"),await animateCSS(e,"fadeIn")))}()})})};filter();const optionResource="option",editCard=e=>{const{id:t,name:n,price:o,image:r}=e,a=document.querySelector(`.cardOption[data-id="${t}"]`);a.querySelector(".optionTitle").innerHTML=n,a.querySelector(".card-body img").src=r;const i=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o);return a.querySelector(".priceOption").innerHTML=i},cancelSaveOption=document.querySelectorAll(".cancelSaveOption, .formOptions .close");Array.from(cancelSaveOption).forEach(e=>{e.addEventListener("click",e=>{const t=document.querySelector(".formOptions");t.querySelector(".saveOption").dataset.editId="",t.querySelector(".optionName").value="",t.querySelector(".optionImage").value="",t.querySelector(".optionPrice").value=""})});const setFormEditOption=(e,t)=>{const{name:n,price:o,image:r}=t,a=document.querySelector(".formOptions");a.classList.add("edit"),a.querySelector(".optionName").value=n,a.querySelector(".optionImage").value=r,a.querySelector(".optionPrice").value=o,a.querySelector(".saveOption").dataset.editId=e},updateOption=()=>{const e=document.querySelector(".formOptions");e.classList.add("edit");const t=e.querySelector(".optionName").value,n=e.querySelector(".optionImage").value,o=e.querySelector(".optionPrice").value,r=e.querySelector(".saveOption").dataset.editId;update(1),fetch(`${URL}/api/option/${r}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,image:n,price:o})}).then(a=>{update(()=>(e.querySelector(".saveOption").dataset.editId="",e.querySelector(".optionName").value="",e.querySelector(".optionImage").value="",e.querySelector(".optionPrice").value="",editCard({id:r,name:t,image:n,price:o}),$("#formOptions").modal("hide"),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})))}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickUpdateOption=e=>{const t=e.dataset.id;e.addEventListener("click",n=>{const o=e.closest(".row").querySelector(".optionTitle").innerText.replace("\n",""),r=e.closest(".cardOption").querySelector(".card-text > img").src,a=parseFloat(e.closest(".cardOption").querySelector(".priceOption").innerText.replace("R$","").replace(",","."));document.querySelector(".insertOption");return n.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")}),setFormEditOption(t,{name:o,image:r,price:a})})},deleteOption=e=>{const t=e.dataset.id;update(1),fetch(`${URL}/api/option/${t}`,{method:"DELETE",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(t=>{update(()=>{e.closest(".option").remove()})}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickRemoveOption=e=>{e.addEventListener("click",t=>{t.preventDefault(),deleteOption(e)})},showOptions=e=>{update(1,"dark"),fetch(`${URL}/api/option?custom=${e}`).then(e=>e.json()).then(e=>{update(()=>{document.querySelector(".modal.options .modal-title").innerHTML=e.name,document.querySelector(".modal.formOptions .modal-title").innerHTML=`Adicionar ${e.name}`;const{options:t}=e;if(document.querySelector(".optionsContainer").innerHTML="",!t.length)return document.querySelector(".optionsContainer").innerHTML="Não há opções dacastradas para esta customização";t.forEach(e=>{const t=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.price);let n=document.createElement("div");return n.classList.add("col-6","col-lg-4","option"),n.innerHTML=`\n                     <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                    \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                        <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="card-body text-primary">\n                            <p class="card-text">\n                                <img src="${e.image}" class="img-thumbnail">\n                            </p>\n                        </div>\n                        <div class="card-footer bg-transparent">\n                            <a href="#" class="btn btn-primary priceOption">${t}</a>\n                        </div>\n                     </div>`,clickRemoveOption(n.querySelector(".card-header .btn-danger")),clickUpdateOption(n.querySelector(".card-header .editOption")),document.querySelector(".optionsContainer").append(n)})},"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},InsertOption=e=>{const t=document.querySelector(".optionName"),n=document.querySelector(".optionImage"),o=document.querySelector(".optionPrice"),r=document.createElement("div");if(r.classList.add("col-6","col-lg-4","option"),!t.value)return t.setCustomValidity("Informe um nome para esta opção"),t.reportValidity();if(!n.value)return n.setCustomValidity("Informe a url da imagem"),n.reportValidity();if(!o.value)return o.setCustomValidity("Informe um preço para esta opção"),o.reportValidity();const a={customization_id:e,name:t.value,image:n.value,price:parseFloat(o.value)};document.querySelectorAll(".optionsContainer > div").length||(document.querySelector(".optionsContainer").innerHTML=""),update(1),fetch(`${URL}/api/option`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{update(()=>{const t=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.price);return r.innerHTML=`\n                  <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                 \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                          <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                          <div class="card-body text-primary">\n                              <p class="card-text">\n                                  <img src="${e.image}" class="img-thumbnail">\n                              </p>\n                          </div>\n                          <div class="card-footer bg-transparent">\n                             <a href="#" class="btn btn-primary priceOption">${t}</a>\n                          </div>\n                  </div>`,document.querySelector(".optionsContainer").prepend(r),clickRemoveOption(r.querySelector(".card-header .btn-danger")),clickUpdateOption(r.querySelector(".card-header .editOption")),$("#formOptions").modal("hide"),document.querySelector(".insertOption").dataset.insert=!1,$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})})}).catch(e=>(update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})}),console.log(e)))},btnSaveOption=document.querySelector(".saveOption");btnSaveOption.addEventListener("click",e=>{if(e.preventDefault(),btnSaveOption.dataset.editId)return updateOption();InsertOption(document.querySelector(".insertOption").dataset.option)});const getVtexProduct=e=>{if(!e.value)return alert("Informe o sku do produto");const t=e.value;new Headers({Host:"*"});fetch(`https://www.woodprime.com.br/produto/sku/${t}`).then(e=>e.json()).then(e=>{console.log(e)}).catch(e=>console.log(e))},btnSearchProduct=document.querySelector(".btnGetProductVtex");btnSearchProduct.addEventListener("click",e=>{e.preventDefault();let t=document.querySelector(".skuProduct");getVtexProduct(t)});const typeResource="type",tabTypeInsert=e=>{const t=document.createElement("a"),{id:n,name:o}=e;t.classList.add("list-group-item","list-group-item-action"),t.setAttribute("id",`list-type-${n}-list`),t.setAttribute("role","tab"),t.setAttribute("aria-selected","false"),t.setAttribute("aria-controls",`list-type-${n}`),t.setAttribute("href",`#list-type-${n}`),t.dataset.toggle="list",t.innerHTML=o;const r=document.createElement("div");r.classList.add("tab-pane","fade"),r.setAttribute("id",`list-type-${n}`),r.setAttribute("role","tabpanel"),r.setAttribute("aria-labelledby",`list-type-${n}-list`);const a=()=>{const e=document.createElement("div");return e.classList.add("row"),e.innerHTML=`<div class="col-12">\n         <nav aria-label="..." class="paginate-type-${n}" data-resource="type">\n            <ul class="pagination">\n            <li class="page-item disabled">\n               <span class="page-link">Previous</span>\n            </li>\n            <li class="page-item active" aria-current="page">\n               <span class="page-link">\n                  1\n                  <span class="sr-only">(current)</span>\n               </span>\n            </li>\n            <li class="page-item">\n               <a class="page-link" href="#">Next</a>\n            </li>\n            </ul>\n         </nav>\n      </div> \x3c!-- Paginação // --\x3e`,e},i=document.createElement("div");return i.classList.add("row",`container-type-${n}`),document.querySelector(".tabContentTypes").append(r),r.append(a()),r.append(i),r.append(a()),document.querySelector(".tabTypes").append(t)},tabTypeRemove=e=>{document.querySelector(`#list-type-${e}-list`).remove(),document.querySelector(`#list-type-${e}`).remove()},insertType=e=>{if(!e.value)return alert("Informe o nome do tipo de customização");update(1,"dark"),fetch(`${URL}/api/type`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:e.value})}).then(t=>{update(2,"dark"),t.json().then(t=>{const n=document.createElement("div");return n.classList.add("card","mb-3","card-type"),n.id=`type-${t.id}`,n.style.flex="0 0 calc(33.333333% - 10px)",n.style.margin="0 5px",n.innerHTML=`<div class="card-body text-center">\n                <h6 class="card-title mb-0">${t.name}</h6>\n              </div>\n              <div class="types-hover">\n                <button type="button" class="btn btn-danger del-type" data-delete="#type-${t.id}">\n                  <i class="fas fa-trash-alt"></i>\n                </button>\n                <button type="button" class="btn btn-success select-type" data-dismiss="modal" type-id="${t.id}" data-select="#type-${t.id}">\n                  <i class="fas fa-check"></i>\n                </button>\n              </div>`,e.value="",update(()=>{document.querySelector(".typesContainer").prepend(n),n.querySelector(".select-type").addEventListener("click",e=>{e.preventDefault(),console.log("selecionei"),selectType(n.querySelector(".select-type"))}),tabTypeInsert({id:t.id,name:t.name});const e=n.querySelector(".del-type");return e.addEventListener("click",t=>{t.preventDefault(),deleteType(e)})},"dark")}).catch(e=>console.log(e))}).catch(e=>{console.log(e)})},btnInsertType=document.querySelector(".insertType");btnInsertType.addEventListener("click",e=>{e.preventDefault(),insertType(document.querySelector(".typeName"))});const deleteType=e=>{const t=parseInt(e.getAttribute("data-delete").replace("#type-",""));update(1,"dark"),fetch(`${URL}/api/type/${t}`,{method:"DELETE"}).then(n=>{update(2,"dark"),n.json().then(n=>update(()=>(tabTypeRemove(t),document.querySelector(e.getAttribute("data-delete")).remove()),"dark")).catch(e=>console.log(e))}).catch(e=>{console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})},"dark")})},btnDeleteType=document.querySelectorAll(".del-type");Array.from(btnDeleteType).forEach(e=>{e.addEventListener("click",t=>(t.preventDefault(),deleteType(e)))});const selectType=e=>{const t=e.getAttribute("type-id");document.querySelector(".typeCustom").value=t;const n=e.closest(".card-type").querySelector(".card-title");return document.querySelector(".btn-modal-types").classList.remove("btn-primary"),document.querySelector(".btn-modal-types").classList.add("btn-success"),document.querySelector(".btn-modal-types").innerHTML=n.innerHTML};let btnSelect=document.querySelectorAll(".select-type");Array.from(btnSelect).forEach(e=>{e.addEventListener("click",function(t){selectType(e)})});