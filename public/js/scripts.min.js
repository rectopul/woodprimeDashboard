const URL="http://192.168.0.10";function update(e,t){var o=document.querySelector(".barload");t&&"dark"==t?o.classList.add("dark"):o.classList.remove("dark");var n=1;if("function"==typeof e){n=33;var r=setInterval(s,14);function s(){n>=100?(n=1,o.style.width="0%",e(),clearInterval(r)):(n++,o.style.width=n+"%")}}if("number"==typeof e&&2===e){n=33;r=setInterval(s,14);function s(){if(65===n)return clearInterval(r);n++,o.style.width=n+"%"}}if("number"==typeof e&&1===e){n=1;r=setInterval(s,7);function s(){if(33===n)return clearInterval(r);n++,o.style.width=n+"%"}}}const util=(()=>{return{request:e=>new Promise((t,o)=>{const{headers:n,body:r,method:s,url:a}=e;var c=new Headers;n["content-type"]&&c.append("Content-Type",n["content-type"]);var i={method:s||"GET",headers:c};r&&(i.body=JSON.stringify(r));var d=new Request(a,i);fetch(d).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}),serialize:e=>{const t=[...e.elements],o={};return t.map((e,t)=>{if("radio"==e.type)return e.checked?o[e.name]=e.value:void 0;e.name&&(o[e.name]=e.value)}),o},get:function(e){return new Promise((t,o)=>{fetch(e,{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>e.error?o(e.error):t(e)).catch(e=>console.log(e))})}}})(),spinner=(e,t)=>{const o=document.createElement("div");return o.classList.add("spinner-border",`text-${e||"primary"}`),t&&"small"===t&&o.classList.add("spinner-border-sm"),o.setAttribute("role","status"),o.innerHTML='<span class="sr-only">Loading...</span>',o},animateCSS=async(e,t,o="animate__")=>new Promise((n,r)=>{const s=`${o}${t}`,a=e;a.classList.add(`${o}animated`,s),a.addEventListener("animationend",function e(){a.classList.remove(`${o}animated`,s),a.removeEventListener("animationend",e),n("Animation ended")})});$(document).ready(function(){$(".dropdown-toggle").dropdown(),$('[data-toggle="tooltip"]').tooltip()}),window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",function(t){!1===e.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")},!1)})},!1);const btnInsertCustom=document.querySelector(".btn-insert-custom"),custonResource="custon",custom=(()=>{const e={types:[],custons:[],options:[],childs:[]},t=document.querySelector(".optionsSelected"),o=(e,t)=>{const{id:o,name:s}=e,a=document.createElement("div");return a.classList.add("col-md-3",`${"type"===t?"typeSelected":"customSelected"}-${o}`),a.dataset.id=o,a.innerHTML=`\n      <div class="card">\n         <div class="card-header">\n            All ${"type"===t?"Type":"Custom"}\n         </div>\n\n         <div class="card-body">\n            <h3>${s}</h3>\n         </div>\n\n         <div class="card-footer text-muted">\n            <button class="btn btn-primary" data-id="${o}"><i class="far fa-trash-alt"></i></button>\n         </div>\n      </div>\n      `,"type"==t?r(a.querySelector("button")):n(a.querySelector("button")),a},n=t=>{t.addEventListener("click",o=>{o.preventDefault();const n=t.dataset.id,r=document.querySelector(`.listCustomByType div[data-id="${n}"] .selectAllCustom`);e.custons.splice(e.custons.indexOf(n),1),t.closest(`.customSelected-${n}`).remove(),r.checked=!1})},r=t=>{t.addEventListener("click",o=>{o.preventDefault();const n=t.dataset.id,r=document.querySelector(`.productType[data-id="${n}"] .selectAllType`);e.types.splice(e.types.indexOf(n),1),t.closest(`.typeSelected-${n}`).remove(),r.checked=!1})},s=t=>{t.addEventListener("click",o=>{o.preventDefault();const n=t.dataset.id;e.options.splice(e.options.indexOf(n),1),t.closest(`.optionSelected-${n}`).remove()})};function a(t,o){let n;n=o?e.options.filter(e=>e.custom!=o):e.options.filter(e=>e.id!=t),e.options=n,console.log(e)}const c=o=>{o.addEventListener("click",n=>{const r=parseInt(o.dataset.id),c=o.querySelector("h5").textContent,i=document.querySelector(".listOptionstoSelect > .active");i.classList.add("selected"),o.classList.toggle("show"),o.classList.contains("show")?(a(r),o.closest(".listCustomByType").querySelector(".show")||i.classList.remove("selected"),t&&t.querySelector(`.optionSelected-${r}`).remove()):(t&&t.append((e=>{const{name:t,id:o}=e,n=document.createElement("div");n.classList.add("col-md-3",`optionSelected-${o}`),n.dataset.id=o,n.dataset.custom=e.customization_id,n.innerHTML=`\n      <div class="card">\n         <div class="card-header">\n            Option\n         </div>\n\n         <div class="card-body">\n            <h6>${t}</h6>\n         </div>\n\n         <div class="card-footer text-muted">\n            <button class="btn btn-primary" data-id="${o}">\n               <i class="far fa-trash-alt" aria-hidden="true"></i>\n            </button>\n         </div>\n      </div>\n      `;const r=n.querySelector("button");return s(r),n})({id:r,name:c})),function(t){const{id:o,custom:n}=t;e.options.push({id:o,custom:n}),e.options}({id:r,custom:parseInt(o.dataset.custom)})),console.log("Selecionei aqui",e)})};const i=e=>new Promise((t,o)=>{update(1,"dark"),fetch(`/api/custon/${e}`,{method:"DELETE",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>(update(2,"dark"),0===e?o("Customização não existe"):t("Customização excluída com sucesso!"))).catch(e=>o("Erro ao excluir customização"))}),d=e=>{e.addEventListener("click",t=>{t.preventDefault();const o=document.querySelector(".actionConfirm"),n=document.querySelector(".aceptAction");o.value="customDestroy",n.dataset.id=e.dataset.id,$(".modalActionConfirm").modal("show")})},l=e=>{const t=document.createElement("div"),{id:o,name:n,description:r,type:s}=e;t.classList.add("col-3",`card-custom-${o}`),t.dataset.category=`type-${s}`,t.dataset.id=o,t.innerHTML=`\n       <div class="card border-primary mb-3 cardCustom" data-id="${o}">\n            <div class="card-header">\n               <span>${n}</span>\n               <button type="button" \n                  class="btn btn-danger btn-sm btnDeleteCustom" \n                  data-id="${o}"\n               >\n                  <i class="fas fa-trash-alt"></i>\n               </button>\n\n               \x3c!--  change custom --\x3e\n                <button type="button" class="btn btn-primary btn-sm btnChangeCustom" data-id="${o}">\n                    <i class="fas fa-edit" aria-hidden="true"></i>\n                </button>\n            </div>\n           <div class="card-body text-primary">\n               <p class="card-text">${r}</p>\n               <button type="button"\n                  class="btn btn-primary btnShowOptionsCustom"\n                  data-custom="${o}"\n                  data-toggle="tooltip"\n                  data-placement="top"\n                  title="Visualizar opções"\n               >\n                  <i class="far fa-eye"></i>\n               </button>\n           </div>\n       </div>`;const a=t.querySelector(".btnShowOptionsCustom");u(a);const c=t.querySelector(".btnDeleteCustom");return d(c),f(t.querySelector(".btnChangeCustom")),t},u=e=>e.addEventListener("click",t=>(t.preventDefault(),$("#options").modal("show"),document.querySelector(".optionsContainer").innerHTML='\n         <div class="spinner-border text-primary" role="status">\n            <span class="sr-only">Loading...</span>\n         </div>',document.querySelector(".modal.options .modal-title").innerHTML='\n         <div class="spinner-border text-primary" role="status">\n            <span class="sr-only">Loading...</span>\n         </div>',document.querySelector(".modal.formOptions .modal-title").innerHTML='\n         <div class="spinner-border text-primary" role="status">\n            <span class="sr-only">Loading...</span>\n         </div>',document.querySelector(".insertOption").dataset.option=e.dataset.custom,showOptions(e.dataset.custom))),m=e=>{const{id:t,name:o,description:n,type:r}=e,s=l(e);return document.querySelector(".container-types").prepend(s),$(s.querySelector(".btnShowOptionsCustom")).tooltip(),u(s.querySelector(".btnShowOptionsCustom"))},p=e=>{e.addEventListener("click",async t=>{t.preventDefault(),update(1,"dark");try{const t=e.dataset.id,o=document.querySelector(".listCustomByType");if(o.innerHTML="",!t)return console.log("Nenhum id selecionado");const n=await util.request({url:`/api/custon/option/${t}`,headers:{"content-type":"application/json"}});return update(()=>{const{options:t}=n;if(!t.length)return o.innerHTML="Nenhuma opção disponível";o.innerHTML="",t.map(e=>o.append(h(e))),$("#productCustonsNv1").modal("show"),$("#productCustonsNv1").on("hidden.bs.modal",function(t){e.closest(".col-md-3.mb-3").classList.remove("active"),$(this).off("hidden.bs.modal")}),e.closest(".col-md-3.mb-3").classList.add("active")},"dark")}catch(e){}})},h=t=>{const{id:o,name:n,image:r}=t,s=document.createElement("div");return s.classList.add("col-md-3"),e.options.filter(e=>e.id===o).length||s.classList.add("show"),s.dataset.id=t.id,s.dataset.custom=t.customization_id,s.innerHTML=`\n        <div class="card border-primary mb-3 cardOption" data-id="${o}">\n            <div class="card-header">\n                <h5>${n}</h5>\n            </div>\n            <div class="card-body text-primary">\n                <p class="card-text">\n                <img src="${r}" class="img-thumbnail">\n                </p>\n            </div>\n        </div>\n      `,c(s),s},y=n=>{const r=document.createElement("div");r.classList.add("col-md-4"),r.dataset.id=n.id;const s=-1!=e.custons.indexOf(`${n.id}`)?"checked":"";r.innerHTML=`\n      <div class="card border-primary mb-3">\n\n         <div class="card-header d-flex justify-content-between align-items-center">\n         Selecionar Todos\n         <input type="checkbox" class="ml-auto selectAllCustom" id="selectAllCustom" value="${n.id}" ${s}>\n         </div>\n\n         <div class="card-body text-primary text-center customNv1Item" data-id="${n.id}" data-dismiss="modal">\n         <h6>${n.name}</h6>\n         </div>\n      </div>\n      `,(n=>{n.addEventListener("change",r=>{const s=n.value,a=n.closest(".card").querySelector("h6").textContent,c=n.closest(".col-md-4");1==n.checked?(console.log("mostra algo"),e.custons.push(s),c.classList.add("selected"),t.append(o({id:s,name:a},"custom"))):(e.custons.splice(e.custons.indexOf(s),1),c.classList.remove("selected"),t.querySelector(`.customSelected-${s}`).remove())})})(r.querySelector(".selectAllCustom"));const a=r.querySelector(".customNv1Item");return p(a),r};function v(e){const{name:t,description:o,id:n,order:r}=e,s=document.querySelector("#changeCustomModal form");return s.elements.name.value=t,s.elements.description.value=o,s.elements.order.value=r,s.dataset.id=n,$("#changeCustomModal").modal("show")}function f(e){e.addEventListener("click",function(t){const o=e.dataset.id;if(o)return function(e){return new Promise((t,o)=>{util.get(`/api/custom/${e}`).then(t).catch(o)})}(o).then(v).catch(console.log)})}return{handleRemoveOption:a,insertOption:function(t){e.options.filter(e=>e.id===t.id).length||e.options.push(t)},selectCustom:function(t){return e.custons.push(parseInt(t))},removeCustom:function(t){const o=e.custons.filter(e=>e!=t);return e.custons=o},create:()=>{const e=document.querySelector(".typeCustom"),t=document.querySelector(".nameCustom"),o=document.querySelector(".descCustom"),n=document.querySelector(".formCreateCustom"),r=util.serialize(n);return console.log(r),(e=>new Promise((t,o)=>{e.map(e=>{const{input:n,msg:r}=e;return n.value?t():(n.setCustomValidity(r),n.reportValidity(),o(r))})}))([{input:e,msg:"Informe o nome da customização"},{input:t,msg:"Informe uma descrição para a customização"},{input:o,msg:"Selecione o tipo de customização"}]).then(r=>(document.querySelector(".loaderInsertCustom").classList.add("show"),(e=>new Promise((t,o)=>{const{name:n,description:r,typeCustom:s,order:a}=e;update(1,"dark"),fetch("/api/custon",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:n,description:r,type_id:s,order:a})}).then(e=>e.ok?e.json():o("Não foi possível cadastrar a customização")).then(e=>e.error?o(e.error):t(e)).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))}))(util.serialize(n)).then(n=>{const{name:r,description:s,id:a}=n;return update(()=>(Swal.fire({title:`Customização ${n.name} cadastrada`,icon:"success",showCloseButton:!0}),(e=>{const{id:t,name:o,type:n,type_id:r,description:s}=e,a=document.createElement("div");a.classList.add("col-4","productOption",`product-option-${t}`),a.dataset.customName=n.name||null,a.dataset.custom=t,a.dataset.id=t,a.dataset.customName=a.innerHTML=`\n      <div class="card border-primary mb-3 productCustom item" data-dismiss="modal" data-option-id="32">\n         <div class="card-header productOptionName">\n               ${o}\n         </div>\n   \n         <div class="card-body text-primary productOptionDesc">\n            <p class="card-text">${s}</p>\n         </div>\n      </div>`;const c=a.querySelector(".card");clickCustom(c),document.querySelector(".productCustonsBody").append(a)})(n),document.querySelector(".btn-modal-types").classList.remove("btn-success"),document.querySelector(".btn-modal-types").classList.add("btn-primary"),document.querySelector(".btn-modal-types").innerHTML="Items",console.log(e.value),m({name:r,description:s,id:a,type:e.value}),e.value="",t.value="",o.value="",document.querySelector(".loaderInsertCustom").classList.remove("show")),"dark")}).catch(e=>Swal.fire({title:e,icon:"error",showCloseButton:!0})))).catch(e=>console.log(e))},destroy:d,showOptions:u,createCard:l,cardCustom:m,handleResetForm:()=>{const e=document.querySelectorAll(".informationProduct .form-row"),t=document.querySelectorAll(".subProducts > div");t&&Array.from(t).forEach(e=>e.remove()),e&&Array.from(e).forEach(e=>e.remove())},changeLevel:e=>{e.addEventListener("click",async t=>{t.preventDefault();try{const t=e.dataset.id,o=document.querySelector(".listCustomByType");if(o.innerHTML="",$("#productCustons").on("hidden.bs.modal",function(e){$("#productCustonsNv1").modal("show"),$(this).off("hidden.bs.modal")}),!t)return Swal.fire({title:"Nenhum id Selecionado",icon:"error",showCloseButton:!0});const n=await util.request({url:`/api/type/${t}`,headers:{"content-type":"application/json"}}),{customization:r}=n;if(!r.length)return o.innerHTML="Nenhuma customisação deste tipo";r.map(e=>{o.append(y(e))})}catch(e){}})},closeCustom:e=>{e.addEventListener("click",function(e){e.preventDefault(),$("#productCustonsNv1").on("hidden.bs.modal",function(e){$(this).off("hidden.bs.modal")})})},allTypes:n=>{n.addEventListener("change",r=>{const s=n.value,a=n.closest(".productType").querySelector("h3").textContent,c=n.closest(".productType");1==n.checked?(e.types.push(s),c.classList.add("selected"),t.append(o({id:s,name:a},"type"))):(e.types.splice(e.types.indexOf(s),1),c.classList.remove("selected"),t.querySelector(`.typeSelected-${s}`).remove())})},getExcludes:()=>e,getOptions:p,handleChild:({name:t,description:o,image:n})=>e.childs.push({name:t,description:o,image:n}),handleChildForm:e=>{const{name:t,id:o,nameProduct:n}=e,r=document.createElement("div");return r.classList.add("form-row"),r.innerHTML=`\n         \n         <div class="form-group col-12 mt-4">\n            <hr>\n            <label for="descriptionChildren-${o}">Descrição ${t}</label>\n            <textarea class="form-control" id="descriptionChildren-${o}" rows="3" placeholder="Informe uma descrição"></textarea>\n            <input type="hidden" id="nameChildren-${o}" value="${n} - ${t}" required>\n            <input type="hidden" id="codeChildren-${o}" value="${o}" required>\n         </div>\n         <div class="form-group col-12">\n            <label for="imageChildren-${o}">Imagem ${t}</label>\n            <input type="text" class="form-control" id="imageChildren-${o}" placeholder="https://www.image.com">\n         </div>\n       `,r},changeCustom:function(e){const t=[...document.querySelectorAll(e)];t&&t.map(f)},handleFormChangeCustom:function(e){e.addEventListener("submit",function(t){t.preventDefault();const o=e.dataset.id;if(!o)return;const n=util.serialize(e);return n.id=o,(r=n,new Promise((e,t)=>{const{id:o,name:n,description:s,order:a}=r;fetch(`/api/custon/${o}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:n,description:s,order:a})}).then(e=>e.json()).then(o=>o.error?t(o.error):e(o)).catch(e=>console.log(e))})).then(e=>{!function(e){const{id:t,name:o,description:n}=e,r=document.querySelector(`.card-custom-${t}`);r&&(r.querySelector(".card-header > span").innerHTML=o,r.querySelector(".card-body > p").innerHTML=n)}(e),$("#changeCustomModal").modal("hide"),$("#changeCustomModal").on("hidden.bs.modal",function(t){Swal.fire({title:`Customização ${e.name} alterada com sucesso!`,icon:"success",showCloseButton:!0}),$(this).off("#changeCustomModal")})}).catch(e=>Swal.fire({title:e,icon:"error",showCloseButton:!0}));var r})},handleDeleteCustom:function(){const e=document.querySelector(".aceptAction"),t=document.querySelector(".actionConfirm");e.addEventListener("click",function(o){const n=e.dataset.id;if(n)return"customDestroy"==t.value?i(n).then(e=>(console.log(e),update(()=>{const t=document.querySelector(`.card-custom-${n}`);return t&&t.remove(),Swal.fire({title:e,icon:"success",showCloseButton:!0})},"dark"))).catch(e=>(console.log(e),update(()=>{Swal.fire({title:e,icon:"error",showCloseButton:!0})},"dark"))):void 0})}}})();custom.handleDeleteCustom(),custom.changeCustom(".btnChangeCustom");const formChangeCustom=document.querySelector("#changeCustomModal form");formChangeCustom&&custom.handleFormChangeCustom(formChangeCustom);const btnGetOptions=document.querySelectorAll(".listOptionstoSelect > div a.btn");btnGetOptions&&Array.from(btnGetOptions).forEach(e=>custom.getOptions(e));const allTypes=document.querySelectorAll(".selectAllType");allTypes&&Array.from(allTypes).forEach(e=>custom.allTypes(e));const btnCloseCustom=document.querySelector(".closeCustom");btnCloseCustom&&custom.closeCustom(btnCloseCustom);const typesCustom=document.querySelectorAll(".typeCustomItem");typesCustom&&Array.from(typesCustom).forEach(e=>custom.changeLevel(e)),btnInsertCustom.addEventListener("click",e=>(e.preventDefault(),custom.create()));const cardCustom=document.querySelectorAll(".btnShowOptionsCustom");Array.from(cardCustom).forEach(e=>custom.showOptions(e));const openFormOption=document.querySelector(".insertOption");openFormOption.addEventListener("click",function(e){e.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")})});const controller=new AbortController,signal=controller.signal,indexCustom=()=>{fetch("/api/custon",{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{e.length>0&&update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{if(e.type_id){const t=custom.createCard({name:e.name,description:e.description,id:e.id,type:e.type_id});document.querySelector(".container-types").append(t)}})):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},findCustoms=e=>{fetch(`/api/custon/search/${e}`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{custom.cardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})})):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},searchCustom=()=>{const e=document.querySelector(".search-custom"),t=document.querySelector(".customSearchButton"),o=document.querySelector(".formSearchCustom");t.addEventListener("click",function(t){t.preventDefault();const o=e.value;return o.length<3?(update(1,"dark"),void fetch("/api/custon",{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{e.length>0&&update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{if(e.type_id){const t=custom.createCard({name:e.name,description:e.description,id:e.id,type:e.type_id});document.querySelector(".container-types").append(t)}})):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})):o.length>3?(update(1,"dark"),findCustoms(o)):void 0}),o.addEventListener("submit",function(t){t.preventDefault();const o=e.value;if(o.length>3)return update(1,"dark"),findCustoms(o)})};searchCustom();const filter=()=>{const e=document.querySelectorAll(".filtersCustom > a");Array.from(e).forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const o=e.dataset.filter,n=document.querySelectorAll(".container-types > div");document.querySelectorAll(`.container-types > div[data-category="${o}"]`);if("type-all"==o)return Array.from(n).forEach(e=>{e.classList.remove("hide")}),Array.from(n).forEach(e=>animateCSS(e,"fadeIn"));let r=[],s=[];Array.from(n).forEach(e=>{return e.dataset.category!=o?s.push(e):r.push(e)}),async function(){await Array.from(s).forEach(async e=>await animateCSS(e,"bounceOut").then(()=>e.classList.add("hide"))),await Array.from(r).forEach(async e=>(e.classList.remove("hide"),await animateCSS(e,"fadeIn")))}()})})};filter();const btnDestroyCustom=document.querySelectorAll(".btnDeleteCustom");Array.from(btnDestroyCustom).forEach(e=>custom.destroy(e));const insertUser=e=>new Promise((t,o)=>{const{name:n,email:r,password:s}=e;update(1,"dark"),fetch("/api/user",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:n,email:r,password:s})}).then(e=>e.json()).then(e=>e.error?o("Erro ao inserir novo usuário"):(update(2,"dark"),t(e))).catch(e=>o(e))}),formNewUser=e=>{e.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector(".newUserName"),o=document.querySelector(".newUserMail"),n=document.querySelector(".newUserPassword"),r=t.value,s=o.value,a=n.value;return console.log({name:r,email:s,password:a}),r?s?a?void insertUser({name:r,email:s,password:a}).then(e=>{const{success:t}=e;return update(()=>{const e=document.createElement("tr");return e.innerHTML=`\n                <th scope="row">${t.id}</th>\n                <td>${t.name}</td>\n                <td>${t.email}</td>\n                <td class="td-actions text-right">\n                    <button type="button" class="btn btn-danger btnRemoveUser" data-id="${t.id}">\n                        <i class="far fa-trash-alt" aria-hidden="true"></i> Excluir\n                    </button>\n                </td>\n                `,document.querySelector(".listUserInSistem").append(e),clickToDestroyUser(e.querySelector(".btnRemoveUser")),$("#newUser").modal("hide"),$("#newUser").on("hidden.bs.modal",function(e){return Swal.fire({title:`Usuário ${t.name} criado com sucesso!`,icon:"success",showCloseButton:!0}),document.querySelector(".modal-backdrop").remove()})},"dark")}).catch(e=>{update(()=>Swal.fire({title:e,icon:"error",showCloseButton:!0}),"dark")}):(n.setCustomValidity("Informe uma senha para o usuário"),n.reportValidity()):(o.setCustomValidity("Informe o e-mail do usuário"),o.reportValidity()):(t.setCustomValidity("Informe o nome do usuário"),t.reportValidity())})},formInsertNewUser=document.querySelector(".btnInsertNewUser");formNewUser(formInsertNewUser);const destroyUser=e=>new Promise((t,o)=>{update(1,"dark"),fetch(`/api/user/${e}`,{method:"DELETE",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>e.error?o("Erro ao inserir novo usuário"):(update(2,"dark"),t(e))).catch(e=>o(e))}),clickToDestroyUser=e=>{e.addEventListener("click",function(t){const o=e.dataset.id;return destroyUser(o).then(()=>(e.closest("tr").remove(),update(()=>{Swal.fire({title:"Usuário deletado com sucesso!",icon:"success",showCloseButton:!0})},"dark"))).catch(e=>update(()=>{Swal.fire({title:"Erro ao deletar usuário!",icon:"error",showCloseButton:!0})},"dark"))})},btnsRemoveUser=document.querySelectorAll(".btnRemoveUser");Array.from(btnsRemoveUser).forEach(e=>clickToDestroyUser(e));const user={changePassword:e=>{e.addEventListener("submit",t=>{if(t.preventDefault(),e.checkValidity()){const t=e.dataset.id,o=e.querySelector(".newPassword").value;update(1,"dark"),util.request({method:"PUT",url:`/api/user/${t}`,headers:{"content-type":"application/json"},body:{password:o}}).then(e=>update(()=>{$("#changePasswordModal").modal("hide"),$("#changePasswordModal").on("hidden.bs.modal",function(e){return document.querySelector(".modal-backdrop")&&document.querySelector(".modal-backdrop").remove(),Swal.fire({title:"Senha atualizada",icon:"success",showCloseButton:!0})})},"dark"))}})}},formChangePassword=document.querySelector(".formChangePassword");formChangePassword&&user.changePassword(formChangePassword);const optionResource="option",editCard=e=>{const{id:t,name:o,image:n}=e,r=document.querySelector(`.cardOption[data-id="${t}"]`);return r.querySelector(".optionTitle").innerHTML=o,r.querySelector(".card-body img").src=n},cancelSaveOption=document.querySelectorAll(".cancelSaveOption, .formOptions .close");Array.from(cancelSaveOption).forEach(e=>{e.addEventListener("click",e=>{const t=document.querySelector(".formOptions");t.querySelector(".saveOption").dataset.editId="",t.querySelector(".optionName").value="",t.querySelector(".optionImage").value=""})});const setFormEditOption=(e,t)=>{const{name:o,price:n,image:r}=t,s=document.querySelector(".formOptions");s.classList.add("edit"),s.querySelector(".optionName").value=o,s.querySelector(".optionImage").value=r,s.querySelector(".saveOption").dataset.editId=e},updateOption=()=>{const e=document.querySelector(".formOptions");e.classList.add("edit");const t=e.querySelector(".optionName").value,o=e.querySelector(".optionImage").value,n=e.querySelector(".saveOption").dataset.editId;update(1),fetch(`/api/option/${n}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,image:o})}).then(r=>{update(()=>(e.querySelector(".saveOption").dataset.editId="",e.querySelector(".optionName").value="",e.querySelector(".optionImage").value="",editCard({id:n,name:t,image:o}),$("#formOptions").modal("hide"),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})))}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickUpdateOption=e=>{const t=e.dataset.id;e.addEventListener("click",o=>{const n=e.closest(".row").querySelector(".optionTitle").innerText.replace("\n",""),r=e.closest(".cardOption").querySelector(".card-text > img").src;document.querySelector(".insertOption");return o.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")}),setFormEditOption(t,{name:n,image:r,price:0})})},deleteOption=e=>{const t=e.dataset.id;update(1),fetch(`/api/option/${t}`,{method:"DELETE",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(t=>{update(()=>{e.closest(".option").remove()})}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickRemoveOption=e=>{e.addEventListener("click",t=>{t.preventDefault(),deleteOption(e)})},showOptions=e=>{update(1,"dark"),fetch(`/api/option?custom=${e}`).then(e=>e.json()).then(e=>{update(()=>{document.querySelector(".modal.options .modal-title").innerHTML=e.name,document.querySelector(".modal.formOptions .modal-title").innerHTML=`Adicionar ${e.name}`;const{options:t}=e;if(document.querySelector(".optionsContainer").innerHTML="",!t.length)return document.querySelector(".optionsContainer").innerHTML="Não há opções castradas para esta customização";t.forEach(e=>{let t=document.createElement("div");return t.classList.add("col-6","col-lg-4","option"),t.innerHTML=`\n                     <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                    \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                        <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="card-body text-primary">\n                            <p class="card-text">\n                                <img src="${e.image}" class="img-thumbnail">\n                            </p>\n                        </div>\n                     </div>`,clickRemoveOption(t.querySelector(".card-header .btn-danger")),clickUpdateOption(t.querySelector(".card-header .editOption")),document.querySelector(".optionsContainer").append(t)})},"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},InsertOption=e=>{const t=document.querySelector(".optionName"),o=document.querySelector(".optionImage"),n=document.createElement("div");if(n.classList.add("col-6","col-lg-4","option"),!t.value)return t.setCustomValidity("Informe um nome para esta opção"),t.reportValidity();if(!o.value)return o.setCustomValidity("Informe a url da imagem"),o.reportValidity();const r={customization_id:e,name:t.value,image:o.value,price:0};document.querySelectorAll(".optionsContainer > div").length||(document.querySelector(".optionsContainer").innerHTML=""),update(1),fetch("/api/option",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)}).then(e=>e.json()).then(e=>{update(()=>(n.innerHTML=`\n                  <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                 \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                          <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                          <div class="card-body text-primary">\n                              <p class="card-text">\n                                  <img src="${e.image}" class="img-thumbnail">\n                              </p>\n                          </div>\n                  </div>`,document.querySelector(".optionsContainer").prepend(n),clickRemoveOption(n.querySelector(".card-header .btn-danger")),clickUpdateOption(n.querySelector(".card-header .editOption")),$("#formOptions").modal("hide"),document.querySelector(".insertOption").dataset.insert=!1,$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})))}).catch(e=>(update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})}),console.log(e)))},btnSaveOption=document.querySelector(".saveOption");btnSaveOption.addEventListener("click",e=>{if(e.preventDefault(),btnSaveOption.dataset.editId)return updateOption();InsertOption(document.querySelector(".insertOption").dataset.option)});const edit=(()=>{const e={options:[],custons:null,childs:null,exclude:[],types:null};async function t(t){try{const o=t.dataset.id;if(!o)return;const n=e;n.id=o;await function(e,t){return new Promise((o,n)=>{const r={url:`/api/product/${e}`,method:"PUT",headers:{"content-type":"application/json"}};fetch(r.url,{method:r.method,headers:r.headers,body:JSON.stringify(t)}).then(e=>e.json()).then(o).catch(n)})}(o,n);Swal.fire({title:"Produto Atualizado",icon:"success",showCloseButton:!0})}catch(e){Swal.fire({title:e,icon:"warning",showCloseButton:!0})}}function o(t,o){if(o&&t&&function(t,o){return!e.options.filter(e=>{if(e.id===t&&e.custom===o)return!0}).length}(t,o)){const n=e.exclude.filter(e=>e.id!=t);return e.exclude=n,e.options.push({id:t,custom:o})}}function n(t){t.preventDefault();let o=t.target;o.classList.contains("optionItem")||(o=o.closest(".optionItem"));const n=o.dataset.id,r=o.dataset.custom;if(!o.classList.contains("remove")){const t=e.options.filter(e=>e.id!=n&&e.custom!=r);e.options=t,e.exclude.push({id:n,custom:r})}o.classList.toggle("remove")}async function r(t,r){const s=document.querySelector(".modalOptionsList");!function(e){$(e).on("hide.bs.modal",function(t){const n=[...$(e)[0].querySelectorAll(".optionItem")];n&&n.forEach(e=>{if(!e.classList.contains("remove"))return o(e.dataset.id,e.dataset.custom)}),$(this).off("hide.bs.modal")})}(s);const a=s.querySelector(".optionsListBySearch");a.innerHTML="",(await function(e){const t={url:`/api/option?custom=${e}`,method:"GET",headers:{"content-type":"application/json"}},{url:o,method:n,headers:r}=t;return new Promise((e,t)=>{fetch(o,{method:n,headers:r}).then(e=>e.json()).then(e).catch(t)})}(t)).options.forEach(t=>{const o=document.createElement("div");o.classList.add("col-md-3","optionItem"),o.dataset.id=t.id,o.dataset.custom=t.customization_id,function(t,o){const n=o.filter(e=>e.option.id==t);if(e.options.length||e.exclude.length){const o=e.options.filter(e=>parseInt(e.id)==t),n=e.exclude.filter(e=>parseInt(e.id)==t);if(n.length)return!1;if(o.length)return!0}if(n.length)return!0;return!1}(t.id,r)||o.classList.add("remove"),o.innerHTML=`<div class="card">\n                <div class="card-header">${t.name}</div>\n                <div class="card-body" style="height: 180px;">\n                    <figure>\n                        <img src="${t.image}" style='height: 100%; width: 100%; object-fit: contain'>\n                    </figure>\n                </div>\n            </div>`,o.addEventListener("click",n),a.append(o)}),$(s).modal("show")}function s(e){return new Promise((t,o)=>{fetch(`/api/custon${e?"/"+e:""}`,{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(t).catch(o)})}async function a(t,n){const r=await s(t),{options:a}=r;a.forEach(t=>n?function(t,o){const n=e.options.filter(e=>e.id!=t);e.options=n,e.exclude.push({id:t,custom:o})}(t.id,t.customization_id):o(t.id,t.customization_id)),console.log(e)}function c(e,t){const o=document.createElement("div");return o.classList.add("listCustonsBySearch__list","row","my-5"),o.innerHTML='<div class="col-12"> <h1>Editar customizações</h1></div>',e.forEach(e=>{const n=document.createElement("div");n.classList.add("col-md-3","my-3","listCustonsBySearch__item"),n.innerHTML=`\n            <div class="card">\n                <div class="card-header">${e.name}</div>\n                <div class="card-body text-center">\n                    <input type="checkbox" class="includeThisCustom mx-auto"\n                        ${function(e,t){return!!e.filter(e=>e.option.customization_id==t).length}(t.options,e.id)?"checked":""} \n                        data-id="${e.id}">\n\n                </div>\n            </div>\n            `,function(e){e.addEventListener("change",function(t){const o=e.dataset.id;0==e.checked?a(o,!0):a(o)})}(n.querySelector("input")),n.querySelector(".card-header").addEventListener("click",function(o){return r(e.id,t.options)}),o.append(n)}),o}return{structure:async function(o,n){const r=c(await s(),await function(e){const t={url:`/api/product/${e}`,method:"GET",headers:{"content-type":"application/json"}},{url:o,method:n,headers:r}=t;return new Promise((e,t)=>{fetch(o,{method:n,headers:r}).then(e=>e.json()).then(e).catch(t)})}(n)),a=document.createElement("div");a.classList.add("col-12","the_button_update","my-5","px-0"),a.innerHTML=`<button type="button" class="btn btn-primary" data-id="${n}">Salvar</button>`,function(e){e.addEventListener("click",function(o){o.preventDefault(),t(e)})}(a.querySelector("button")),o.append(r),o.append(a),e.options=[],e.exclude=[]}}})(),vtexAccountName="woodprime",vtexEnvironment="vtexcommercestable",searching=(()=>{const e=e=>{return console.log("custons",e),e.map(e=>{const{name:t,image:o,customization:r,id:s}=e.option,a=document.createElement("div");return a.classList.add("productInSearch","col-6","col-md-3","my-3"),a.dataset.id=s,a.innerHTML=`\n         <div class="card">\n            <img class="card-img-top" src="${o}" alt="Card image cap">\n            <div class="card-body">\n               <h5 class="card-title">${t}</h5>\n               <small>${r?r.name:""}</small>\n            </div>\n         </div>\n         `,(e=>{e.addEventListener("click",async t=>{try{t.preventDefault(),e.closest(".col-6.col-md-3").style.display="none";const o=e.dataset.id,r=e.closest(".productFind").dataset.id;await n({url:"/api/product_opt",method:"POST",headers:{"content-type":"application/json"},body:{option_id:o,product_id:r}}),e.closest(".col-6.col-md-3").remove()}catch(t){e.closest(".col-6.col-md-3").style.display="flex",console.log(t)}})})(a),a})},t=t=>{console.log("infos",t);const{name:o,id:r,image:s,code:a,custom:c,options:i}=t,d=document.createElement("div");d.classList.add("col-12","productFind"),d.dataset.id=r,d.innerHTML=`\n        <div class="row">\n            <div class="col-md-4">\n            <img src="${s}" alt="" class="img-thumbnail" style="width: 100%">\n            </div>\n\n            <div class="col-md">\n                <h4>${o}</h4>\n\n                <p>${a}</p>\n            </div>\n\n            <div class="col-2 text-right">\n                <button type="button" class="btn btn-danger destrProduct" data-id="${r}">Deletar</button>\n            </div>\n        </div>\n\n        <hr>\n\n        <div class="row">\n            <h1 class="text-center mx-auto mb-4">Customizações</h1>\n            <div class="col-12 productCustoms">\n                <div class="row"></div>\n            </div>\n        </div>\n        `;const l=d.querySelector(".destrProduct");return l&&(e=>{e.addEventListener("click",async t=>{try{t.preventDefault(),e.closest(".productFind").style.display="none";const o=e.dataset.id;return await n({url:`/api/product/${o}`,method:"DELETE",headers:{"content-type":"application/json"}}),e.closest(".productFind").remove()}catch(t){e.closest(".productFind").style.display="flex",console.log(t)}})})(l),[...e(i)].map(e=>{d.querySelector(".productCustoms > .row").append(e)}),edit.structure(d.querySelector(".productCustoms"),r),d},o=e=>{const{id:t,image:o,name:n}=e,s=document.createElement("div");return s.classList.add("col-12"),s.dataset.id=t,s.innerHTML=`\n      <div class="row">\n         <img src="${o}" alt="produto" width="40px" class="img-thumbnail">\n         \x3c!--name of product --\x3e\n         <span>${n}</span>\n      </div>\n      `,r(s),s},n=e=>new Promise((t,o)=>{const{url:n,headers:r,method:s,body:a}=e,c={method:s};r&&(c.headers=r),a&&(c.body=JSON.stringify(a)),fetch(n,c).then(e=>e.json()).then(e=>t(e)).catch(e=>o(e))}),r=e=>{const o=document.querySelector(".listProduct");e.addEventListener("click",async r=>{r.preventDefault();const s=e.dataset.id,a=await n({url:`/api/product/${s}`,method:"GET",headers:{"content-type":"application/json"}});e.closest(".productsFound").classList.remove("show"),o.innerHTML="",o&&o.append(t(a))})};return{search:e=>{e.addEventListener("keyup",t=>{const r=document.querySelector(".productsFound"),s=e.closest("div");if(!s.querySelector(".spinner-border")){const t=document.createElement("div");t.classList.add("spinner-border","text-success"),t.setAttribute("role","status"),t.innerHTML='<span class="sr-only">Loading...</span>',e.closest("div").append(t)}if(!e.value.length)return r.classList.remove("show");e.value&&e.value.length>0&&((e,t,o)=>{void 0===window.delayed_methods&&(window.delayed_methods={}),delayed_methods[e]=Date.now();var n=delayed_methods[e];setTimeout(function(){delayed_methods[e]==n&&(delayed_methods[e]="",t())},o||500)})("check date parallel",async()=>{try{const t=e.value.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=await n({url:`/api/product_search/${t}`,method:"GET",headers:{"content-type":"application/json"}});if(s.querySelector(".spinner-border").remove(),r.length)return(e=>{const t=document.querySelector(".productsFound");t.classList.add("show"),t.innerHTML="",e.map(e=>{const n=o(e);t.append(n)})})(r)}catch(e){console.log(e)}})})}}})(),inputSearch=document.querySelector(".productParamSearch");inputSearch&&searching.search(inputSearch);const createProductBySearch=e=>new Promise((t,o)=>{const{name:n,code:r,image:s,options:a,id:c}=e,i=document.createElement("div");let d="";a.length&&a.forEach(e=>{const{id:t,option:o}=e,n=o.customization?`(${o.customization.name})`:"";d+=`\n            <tr class="text-left optionProduct">\n               <th scope="row" class="px-1 productOptionName">\n                  ${o.name} ${n}\n               </th>\n               \n               <td>${o.price}</td>\n               <td class="text-right px-1 productRemoveOption">\n                  <a href="#" data-id="${t}">\n                  <i class="fas fa-trash-alt"></i>\n                  </a>\n               </td>\n            </tr>\n            `}),i.classList.add("col-4","productItem","my-2"),i.innerHTML=`\n      <div class="card border-primary mb-3 cardProduct item" data-id="${c}">\n         <div class="card-header text-center searchProductName">\n            ${n}\n            <button type="button" class="btn btn-danger btn-sm productDestroy" data-id="${c}">\n               <i class="fas fa-trash-alt"></i>\n            </button>\n         </div>\n   \n         <div class="card-body text-primary searchProductOptionsBody text-center px-1">\n            <table class="table table-hover searchProductOptions mb-0">\n               <thead>\n                  <tr>\n                     <th scope="col" class="text-left px-1">Option</th>\n                     <th scope="col">Preço</th>\n                     <th scope="col" class="text-right px-1">Action</th>\n                  </tr>\n               </thead>\n   \n               <tbody> ${d} </tbody>\n            </table>\n            \x3c!-- TABLE // --\x3e\n         </div>\n      </div>\n      `;const l=i.querySelectorAll(".productRemoveOption > a");Array.from(l).forEach(e=>{actionRemoveOption(e)});const u=i.querySelector(".productDestroy");return product.destroy(u),t(i)}),searchProduct=e=>{update(1,"dark"),fetch(`/api/product_search/${e}`,{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>{update(()=>e.forEach(e=>(document.querySelector(".listProduct").innerHTML="",createProductBySearch(e).then(e=>document.querySelector(".listProduct").append(e)))),"dark")}).catch(e=>Swal.fire({title:e,icon:"error",showCloseButton:!0}))},indexProducts=()=>{update(1,"dark"),fetch("/api/product",{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>{update(()=>e.forEach(e=>(document.querySelector(".listProduct").innerHTML="",createProductBySearch(e).then(e=>document.querySelector(".listProduct").append(e)))),"dark")}).catch(e=>Swal.fire({title:e,icon:"error",showCloseButton:!0}))},internalRequest=e=>new Promise((t,o)=>{fetch(`/api/${productResource}/${e}`,{method:"GET",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(e=>{if(!e)return o("Não há produtos");const{name:t,code:n,image:r}=e})}),getVtexProduct=e=>new Promise((t,o)=>{if(!e.value)return o("Informe o sku do produto");const n=`https://sistema.moveispracasa.com.br/api/admin/products/${e.value}`;new Headers({Host:"*"});fetch(n,{method:"GET",headers:{"content-type":"application/json",accept:"application/json"}}).then(e=>e.json()).then(e=>{const{product:n}=e;if(!n)return o("Produto não encontrado");const{isActiveOnVtex:r}=n;if(!r)return o("Este produto está inativo na Vtex");const{product_name:s,id:a,productName:c,productId:i}=n.vtexData;let d;if(!(d=n.vtexData.itemMetadata?n.vtexData.itemMetadata.items:n.vtexData.items).length)return o("Não há itens");const l={name:s||c,id:a||i};if(n.vtexData.items.length&&(l.skus=n.vtexData.items),d[0]&&d[0].MainImage){const{MainImage:e}=d[0];l.image=e}else{const{images:e}=d[0];if(!e)return o("Não há imagem no produto");l.image=e[0].imageUrl}return t(l)}).catch(e=>o(e))}),putValues=e=>{const{name:t,code:o,image:n}=e;document.querySelector(".nameProduct").value=t,document.querySelector(".codeProduct").value=o,document.querySelector(".productNameInsert").innerHTML=t,document.querySelector(".productCodeInsert b").innerHTML=`Código do produto: ${o}`,document.querySelector(".productImageInsert").setAttribute("src",n)},btnSearchProduct=document.querySelector(".btnGetProductVtex");btnSearchProduct.addEventListener("click",e=>{e.preventDefault(),custom.handleResetForm();let t=document.querySelector(".skuProduct");const o=btnSearchProduct.innerHTML;btnSearchProduct.innerHTML="",btnSearchProduct.append(spinner("ligth","small")),getVtexProduct(t).then(e=>{console.log(e);const{name:t,id:n,image:r,skus:s}=e;if(s&&s.length>1){const e=document.querySelector(".subProducts");e&&(e.innerHTML=""),s.map(o=>{const n=document.createElement("div");n.classList.add("col-md-2","mt-3"),n.innerHTML=`\n                     <div class="card">\n                        <img class="card-img-top" src="${o.images[0].imageUrl}" alt="Card image cap">\n                        <div class="card-body text-center" style="border-top: 1px solid rgba(0,0,0,.125)">\n                           <h6 class="card-title">${o.name}</h6>\n                        </div>\n                     </div>\n                     `,document.querySelector(".informationProduct").append(custom.handleChildForm({id:o.id||o.itemId,name:o.name,nameProduct:t})),e&&e.append(n)})}return document.querySelector(".resultProduct").classList.add("full"),btnSearchProduct.innerHTML=o,putValues({name:t,code:n,image:r})}).catch(e=>Swal.fire({title:e,icon:"error",showCloseButton:!0}))});const productResource="product";let optionsProduct=[];const product=(()=>{return{customInsert:function(e){e.addEventListener("change",async function(t){t.preventDefault();try{if(!0!==e.checked){const t=e.closest(".selected");return t?t.remove("selected"):custom.handleRemoveOption(null,e.value)}const t=await util.request({url:`/api/custon/${e.value}`,headers:{"content-type":"application/json"}});t.options&&t.options.map(e=>{custom.insertOption({id:e.id,custom:e.customization_id})})}catch(e){console.log(e)}})},create:e=>{e.addEventListener("submit",t=>{if(t.preventDefault(),document.querySelector(".nameProduct"),document.querySelector(".codeProduct"),document.querySelector(".descriptionProduct"),document.querySelector(".imageProduct"),e.checkValidity()){const t=[...e.elements],o={children:[]};t.map(e=>{if("BUTTON"!=e.tagName){const t=e.getAttribute("id");e.classList.contains("nameProduct")&&(o.name=e.value),e.classList.contains("codeProduct")&&(o.code=e.value),e.classList.contains("descriptionProduct")&&(o.description=e.value),e.classList.contains("imageProduct")&&(o.image=e.value),t&&-1!==t.indexOf("descriptionChildren")&&o.children.push({description:e.value,name:e.closest("div").querySelector('input[id*="nameChildren"]').value,code:e.closest("div").querySelector('input[id*="codeChildren"]').value,image:e.closest(".form-row").querySelector('input[id*="imageChildren"]').value})}});const n=custom.getExcludes(),{name:r,description:s,code:a,image:c,children:i}=o;return(e=>{const{name:t,code:o,description:n,image:r,options:s,excludes:a,children:c}=e;update(1,"dark"),fetch(`/api/${productResource}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,code:o,description:n,image:r,options:s,excludes:a,children:c})}).then(e=>e.json()).then(e=>{update(()=>{if(e.error)return Swal.fire({title:e.error,icon:"warning",showCloseButton:!0});optionsProduct=[],document.querySelector(".nameProduct").value="",document.querySelector(".codeProduct").value="",document.querySelector(".descriptionProduct").value="",document.querySelector(".imageProduct").value="",document.querySelector(".skuProduct").value="",document.querySelector(".resultProduct").classList.remove("full");const t=document.querySelectorAll(".formInsertProduct .form-row"),o=document.querySelectorAll(".listCustomByType .show"),n=document.querySelectorAll(".listOptionstoSelect .selected");return o&&Array.from(o).forEach(e=>e.classList.remove("show")),n&&Array.from(n).forEach(e=>e.classList.remove("selected")),Array.from(t).forEach(e=>e.remove()),e[0]?Swal.fire({title:`Produto ${e[0].name} cadastrado`,icon:"success",showCloseButton:!0}).then(e=>{e.isConfirmed&&document.location.reload(!0)}):Swal.fire({title:`Produto ${e.name} cadastrado`,icon:"success",showCloseButton:!0}).then(e=>{e.isConfirmed&&document.location.reload(!0)})},"dark")}).catch(e=>{update(()=>Swal.fire({title:"Erro ao inserir novo produto",icon:"error",showCloseButton:!0}),"dark")})})({name:r,code:parseFloat(a),description:s,image:c,options:n,excludes:n,children:i})}})},destroy:e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.dataset.id;return(e=>new Promise((t,o)=>{update(1,"dark"),fetch(`/api/product/${e}`,{method:"DELETE"}).then(e=>e.ok?t("Produto excluído com sucesso!"):o(new Error("HTTP status "+e.status))).catch(e=>o(e))}))(o).then(e=>{update(()=>(document.querySelector(`.productDestroy[data-id="${o}"]`).closest(".productItem").remove(),Swal.fire({title:e,icon:"success",showCloseButton:!0})),"dark")}).catch(e=>{update(()=>(console.log(e),Swal.fire({title:"Erro ao excluir produto!",icon:"warning",showCloseButton:!0})),"dark")})})}}})(),allCheckCustom=[...document.querySelectorAll("#selectAllCustom")];allCheckCustom&&allCheckCustom.map(product.customInsert),$("#modalProductOptions").on("hidden.bs.modal",function(e){$("#productCustons").modal("show")});const destroyProductOption=e=>{update(1,"dark"),fetch(`/api/product_option/${e}`,{method:"DELETE"}).then(e=>e.json()).then(t=>{update(()=>{return document.querySelector(`.productRemoveOption a[data-id="${e}"]`).closest(".optionProduct").remove(),Swal.fire({title:"Customização removida com sucesso!",icon:"success",showCloseButton:!0})},"dark")})},actionRemoveOption=e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.dataset.id;destroyProductOption(o)})},linkRemoveOption=document.querySelectorAll(".productRemoveOption > a");Array.from(linkRemoveOption).forEach(e=>{actionRemoveOption(e)});const btnsDestroyProduct=document.querySelectorAll(".productDestroy");Array.from(btnsDestroyProduct).forEach(e=>product.destroy(e));const clickOption=e=>{e.addEventListener("click",function(t){const o=e.querySelector(".productOptionName").innerHTML,n=e.dataset.id,r=e.dataset.custom,s=e.dataset.customName,a=e.querySelector(".card-body img").getAttribute("src");if(e.classList.add("active"),!document.querySelector(`.optionsSelected div[data-option="${n}"]`))return optionInsert({name:o,id:n,custom:r,custom_name:s,image:a}),optionsProduct.push(parseInt(n))})},optionInsert=e=>{const{id:t,name:o,custom:n,custom_name:r,image:s}=e,a=document.createElement("div");a.classList.add("col-3","optionSelect"),a.dataset.option=t,a.innerHTML=`<div class="card">\n      <div class="card-header text-center productCustomName" data-custom="${n}">\n         <button type="button" class="btn btn-danger btn-sm optionSelectDel" data-id="${t}">\n            <i class="fas fa-trash-alt" aria-hidden="true"></i>\n         </button>\n         ${r}\n      </div>\n      <div class="card-body productOptionName text-center">\n         <p>${o}</p>\n         <div class="row">\n            <div class="col-12">\n               <img src="${s}" alt="..." width="100" class="img-thumbnail">\n            </div>\n         </div>\n      </div>\n   </div>`;const c=a.querySelector(".optionSelectDel");return c.addEventListener("click",e=>{const t=c.dataset.id;return optionsProduct.splice(optionsProduct.indexOf(parseInt(t)),1),c.closest(".optionSelect").remove()}),document.querySelector(".optionsSelected").append(a)},optionsCreate=e=>{const{id:t,name:o,image:n,custom:r,custom_name:s}=e,a=document.querySelector(".modalProductOptionsContainer"),c=document.createElement("div");return c.classList.add("col-3"),c.dataset.custom=r,c.dataset.customName=s,c.dataset.id=t,c.innerHTML=`\n   <div class="card productOption">\n      <div class="card-header productOptionName">${o}</div>\n      <div class="card-body">\n      <img src="${n}" alt="..." width="150" class="img-thumbnail">\n      </div>\n   </div>\n   `,clickOption(c),a.append(c)},getOptions=e=>{document.querySelector(".modalProductOptionsContainer").innerHTML="",document.querySelector(".modalProductOptionsContainer").append(spinner()),fetch(`/api/option?custom=${e}`,{method:"GET"}).then(e=>e.json()).then(e=>{update(()=>{const{options:t}=e;return document.querySelector(".modalProductOptionsContainer").innerHTML="",t.forEach(t=>optionsCreate({id:t.id,custom:t.customization_id,custom_name:e.name,name:t.name,image:t.image}))},"dark")})},clickCustom=e=>{e.addEventListener("click",function(t){t.preventDefault();const o=e.closest(".col-4").dataset.custom;return $("#productCustons").on("hidden.bs.modal",function(e){$("#modalProductOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#modalProductOptions").on("hidden.bs.modal",function(e){$("#productCustons").modal("show")}),getOptions(o)})},customCreate=e=>{const{id:t,name:o,custom:n,custom_name:r}=e,s=document.createElement("div");return s.classList.add("col-3"),s.dataset.option=t,s.innerHTML=`<div class="card">\n      <div class="card-header productCustomName" data-custom="${n}">${r}</div>\n      <div class="card-body productOptionName">\n      ${o}\n      </div>\n   </div>`,document.querySelector(".optionsSelected").append(s)},formInsertProduct=document.querySelector(".formInsertProduct"),productOption=document.querySelectorAll(".productOption .card");Array.from(productOption).forEach(e=>{clickCustom(e)}),formInsertProduct&&product.create(formInsertProduct);const typeResource="type";let type=(()=>{const e=e=>{const t=document.querySelector(".actionConfirm"),o=document.querySelector(".aceptAction");t.value="TypeDestroy",o.dataset.id=parseInt(e.getAttribute("data-delete").replace("#type-","")),$(".modal.types").on("hidden.bs.modal",function(e){$(".modalActionConfirm").modal("show"),$(this).off("hidden.bs.modal")}),$(".modal.types").modal("hide"),o.addEventListener("click",n=>{if("TypeDestroy"==t.value){const t=o.dataset.id;$(".modalActionConfirm").on("hidden.bs.modal",function(e){$(".modal.types").modal("show"),$(this).off("hidden.bs.modal")}),update(1,"dark"),fetch(`/api/type/${t}`,{method:"DELETE"}).then(t=>{update(2,"dark"),t.json().then(t=>update(()=>e.closest(".card").remove(),"dark")).catch(e=>console.log(e))}).catch(e=>{console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})},"dark")})}})},t=e=>{const t=e.getAttribute("type-id");document.querySelector(".typeCustom").value=t;const o=e.closest(".card-type").querySelector(".card-title");return document.querySelector(".btn-modal-types").classList.remove("btn-primary"),document.querySelector(".btn-modal-types").classList.add("btn-success"),document.querySelector(".btn-modal-types").innerHTML=o.innerHTML};return{insertTab:e=>{const t=document.createElement("a"),{id:o,name:n}=e;t.classList.add("list-group-item","list-group-item-action"),t.setAttribute("id",`list-type-${o}-list`),t.setAttribute("role","tab"),t.setAttribute("aria-selected","false"),t.setAttribute("aria-controls",`list-type-${o}`),t.setAttribute("href",`#list-type-${o}`),t.dataset.toggle="list",t.innerHTML=n;const r=document.createElement("div");r.classList.add("tab-pane","fade"),r.setAttribute("id",`list-type-${o}`),r.setAttribute("role","tabpanel"),r.setAttribute("aria-labelledby",`list-type-${o}-list`);const s=()=>{const e=document.createElement("div");return e.classList.add("row"),e.innerHTML=`<div class="col-12">\n               <nav aria-label="..." class="paginate-type-${o}" data-resource="type">\n                  <ul class="pagination">\n                  <li class="page-item disabled">\n                     <span class="page-link">Previous</span>\n                  </li>\n                  <li class="page-item active" aria-current="page">\n                     <span class="page-link">\n                        1\n                        <span class="sr-only">(current)</span>\n                     </span>\n                  </li>\n                  <li class="page-item">\n                     <a class="page-link" href="#">Next</a>\n                  </li>\n                  </ul>\n               </nav>\n            </div> \x3c!-- Paginação // --\x3e`,e},a=document.createElement("div");return a.classList.add("row",`container-type-${o}`),document.querySelector(".tabContentTypes").append(r),r.append(s()),r.append(a),r.append(s()),document.querySelector(".tabTypes").append(t)},removeTab:e=>{document.querySelector(`#list-type-${e}-list`).remove(),document.querySelector(`#list-type-${e}`).remove()},create:o=>{if(!o.value)return alert("Informe o nome do tipo de customização");update(1,"dark"),fetch("/api/type",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:o.value})}).then(n=>{update(2,"dark"),n.json().then(n=>{const r=(o=>{const{id:n,name:r}=o,s=document.createElement("div");s.classList.add("card","mb-3","card-type"),s.id=`type-${n}`,s.style.flex="0 0 calc(33.333333% - 10px)",s.style.margin="0 5px",s.innerHTML=`\n         <div class="card-body text-center">\n            <h6 class="card-title mb-0">${r}</h6>\n         </div>\n         <div class="types-hover">\n            <button type="button" class="btn btn-danger del-type" data-delete="#type-${n}">\n            <i class="fas fa-trash-alt"></i>\n            </button>\n            <button type="button" class="btn btn-success select-type" data-dismiss="modal" type-id="${n}" data-select="#type-${n}">\n            <i class="fas fa-check"></i>\n            </button>\n         </div>`,s.querySelector(".select-type").addEventListener("click",e=>{e.preventDefault(),t(s.querySelector(".select-type"))});const a=s.querySelector(".del-type");return a.addEventListener("click",t=>{t.preventDefault(),e(a)}),s})({id:n.id,name:n.name}),s=document.querySelector(".typesContainer");return o.value="",update(()=>s.prepend(r),"dark")}).catch(e=>console.log(e))}).catch(e=>{console.log(e)})},destroy:e,select:t}})();const btnInsertType=document.querySelector(".insertType");btnInsertType.addEventListener("click",e=>(e.preventDefault(),type.create(document.querySelector(".typeName"))));const btnDeleteType=document.querySelectorAll(".del-type");Array.from(btnDeleteType).forEach(e=>{e.addEventListener("click",t=>(t.preventDefault(),type.destroy(e)))});let btnSelect=document.querySelectorAll(".select-type");Array.from(btnSelect).forEach(e=>{e.addEventListener("click",function(t){return type.select(e)})});const customUpdate=e=>{const{id:t,name:o,description:n,type_id:r}=e;update(1,"dark"),fetch(`/api/custon/${t}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:o,description:n,type_id:r})}).then(e=>{update(()=>(console.log(e),$("#modalUnrelated").modal("hide")),"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},editCustom=()=>{const e=document.querySelectorAll(".unrelatedCustom");document.querySelector(".editCustomForm").addEventListener("submit",e=>{e.preventDefault();const t={id:document.querySelector(".unrelatedCustomId").value,name:document.querySelector("#ulName").value,description:document.querySelector("#ulDescription").value,type_id:parseInt(document.querySelector("#ulTypeId").value)};return customUpdate(t)}),Array.from(e).forEach(e=>{e.addEventListener("click",t=>{const o=e.dataset.id,n=e.querySelector(".unrelatedName").innerHTML,r=e.querySelector(".unrelatedDescription").innerHTML;document.querySelector(".unrelatedCustomId").value=o,document.querySelector("#ulName").value=n,document.querySelector("#ulDescription").value=r,$("#modalUnrelated").modal("show")})})};editCustom();