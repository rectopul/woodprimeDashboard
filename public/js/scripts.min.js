const URL="http://192.168.0.10";function update(e,t){var o=document.querySelector(".barload");t&&"dark"==t?o.classList.add("dark"):o.classList.remove("dark");var n=1;if("function"==typeof e){n=33;var r=setInterval(a,14);function a(){n>=100?(n=1,o.style.width="0%",e(),clearInterval(r)):(n++,o.style.width=n+"%")}}if("number"==typeof e&&2===e){n=33;r=setInterval(a,14);function a(){if(65===n)return clearInterval(r);n++,o.style.width=n+"%"}}if("number"==typeof e&&1===e){n=1;r=setInterval(a,7);function a(){if(33===n)return clearInterval(r);n++,o.style.width=n+"%"}}}const animateCSS=async(e,t,o="animate__")=>new Promise((n,r)=>{const a=`${o}${t}`,i=e;i.classList.add(`${o}animated`,a),i.addEventListener("animationend",function e(){i.classList.remove(`${o}animated`,a),i.removeEventListener("animationend",e),n("Animation ended")})});$(document).ready(function(){$(".dropdown-toggle").dropdown()});const btnInsertCustom=document.querySelector(".btn-insert-custom"),custonResource="custon",createCardCustom=e=>{const t=document.createElement("div"),{id:o,name:n,description:r,type:a}=e;return t.classList.add("col-3",`card-custom-${o}`),t.dataset.category=`type-${a}`,t.dataset.id=o,t.innerHTML=`\n    <div class="card border-primary mb-3 cardCustom" data-id="${o}">\n        <div class="card-header">${n}</div>\n        <div class="card-body text-primary">\n            <p class="card-text">${r}</p>\n        </div>\n    </div>`,t},clickCard=e=>e.addEventListener("click",t=>(t.preventDefault(),$("#options").modal("show"),document.querySelector(".optionsContainer").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".modal.options .modal-title").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".modal.formOptions .modal-title").innerHTML='<div class="spinner-border text-primary" role="status">\n                  <span class="sr-only">Loading...</span>\n              </div>',document.querySelector(".insertOption").dataset.option=e.dataset.id,showOptions(e.dataset.id))),insertCardCustom=e=>{const{id:t,name:o,description:n,type:r}=e,a=createCardCustom(e);document.querySelector(".container-types").prepend(a);const i=document.querySelector(".pillcustoms"),c=parseInt(i.innerHTML);return i.innerHTML=c+1,clickCard(a)};btnInsertCustom.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector(".typeCustom"),o=document.querySelector(".nameCustom"),n=document.querySelector(".descCustom");return o.value?n.value?t.value?(console.log("cliquei no custom"),document.querySelector(".loaderInsertCustom").classList.add("show"),update(1,"dark"),void fetch(`${URL}/api/custon`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:o.value,description:n.value,type_id:t.value})}).then(e=>e.json()).then(e=>{update(()=>(Swal.fire({title:`Customização ${e.name} cadastrada`,icon:"success",showCloseButton:!0}),document.querySelector(".btn-modal-types").classList.remove("btn-success"),document.querySelector(".btn-modal-types").classList.add("btn-primary"),document.querySelector(".btn-modal-types").innerHTML="Tipos de customização",console.log(t.value),insertCardCustom({name:e.name,description:e.description,id:e.id,type:t.value}),t.value="",o.value="",n.value="",document.querySelector(".loaderInsertCustom").classList.remove("show")),"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))):(t.setCustomValidity("Selecione o tipo de customização"),t.reportValidity()):(n.setCustomValidity("Informe uma descrição para a customização"),n.reportValidity()):(o.setCustomValidity("Informe o nome da customização"),o.reportValidity())});const cardCustom=document.querySelectorAll(".cardCustom");Array.from(cardCustom).forEach(e=>{clickCard(e)});const openFormOption=document.querySelector(".insertOption");openFormOption.addEventListener("click",function(e){e.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")})});const controller=new AbortController,signal=controller.signal,indexCustom=()=>{fetch(`${URL}/api/custon`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},findCustoms=e=>{fetch(`${URL}/api/custon/search/${e}`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})},searchCustom=()=>{const e=document.querySelector(".search-custom"),t=document.querySelector(".customSearchButton"),o=document.querySelector(".formSearchCustom");t.addEventListener("click",function(t){t.preventDefault();const o=e.value;return o.length<3?(update(1,"dark"),void fetch(`${URL}/api/custon`,{method:"GET",headers:{"content-type":"application/json"},signal:signal}).then(e=>e.json()).then(e=>{update(()=>e.length?(document.querySelector(".container-types").innerHTML="",e.forEach(e=>{insertCardCustom({name:e.name,description:e.description,id:e.id,type:e.type_id})}),console.log(e)):document.querySelector(".container-types").innerHTML="Nenhum registro encontrado","dark")}).catch(e=>{"AbortError"===e.name&&console.log("abortado")})):o.length>3?(update(1,"dark"),findCustoms(o)):void 0}),o.addEventListener("submit",function(t){t.preventDefault();const o=e.value;if(o.length>3)return update(1,"dark"),findCustoms(o)})};searchCustom();const filter=()=>{const e=document.querySelectorAll(".filtersCustom > a");Array.from(e).forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const o=e.dataset.filter,n=document.querySelectorAll(".container-types > div");document.querySelectorAll(`.container-types > div[data-category="${o}"]`);if("type-all"==o)return Array.from(n).forEach(e=>{e.classList.remove("hide")}),Array.from(n).forEach(e=>animateCSS(e,"fadeIn"));let r=[],a=[];Array.from(n).forEach(e=>{return e.dataset.category!=o?a.push(e):r.push(e)}),async function(){await Array.from(a).forEach(async e=>await animateCSS(e,"bounceOut").then(()=>e.classList.add("hide"))),await Array.from(r).forEach(async e=>(e.classList.remove("hide"),await animateCSS(e,"fadeIn")))}()})})};filter();const optionResource="option",editCard=e=>{const{id:t,name:o,price:n,image:r}=e,a=document.querySelector(`.cardOption[data-id="${t}"]`);a.querySelector(".optionTitle").innerHTML=o,a.querySelector(".card-body img").src=r;const i=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n);return a.querySelector(".priceOption").innerHTML=i},cancelSaveOption=document.querySelectorAll(".cancelSaveOption, .formOptions .close");Array.from(cancelSaveOption).forEach(e=>{e.addEventListener("click",e=>{const t=document.querySelector(".formOptions");t.querySelector(".saveOption").dataset.editId="",t.querySelector(".optionName").value="",t.querySelector(".optionImage").value="",t.querySelector(".optionPrice").value=""})});const setFormEditOption=(e,t)=>{const{name:o,price:n,image:r}=t,a=document.querySelector(".formOptions");a.classList.add("edit"),a.querySelector(".optionName").value=o,a.querySelector(".optionImage").value=r,a.querySelector(".optionPrice").value=n,a.querySelector(".saveOption").dataset.editId=e},updateOption=()=>{const e=document.querySelector(".formOptions");e.classList.add("edit");const t=e.querySelector(".optionName").value,o=e.querySelector(".optionImage").value,n=e.querySelector(".optionPrice").value,r=e.querySelector(".saveOption").dataset.editId;update(1),fetch(`${URL}/api/option/${r}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,image:o,price:n})}).then(a=>{update(()=>(e.querySelector(".saveOption").dataset.editId="",e.querySelector(".optionName").value="",e.querySelector(".optionImage").value="",e.querySelector(".optionPrice").value="",editCard({id:r,name:t,image:o,price:n}),$("#formOptions").modal("hide"),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})))}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickUpdateOption=e=>{const t=e.dataset.id;e.addEventListener("click",o=>{const n=e.closest(".row").querySelector(".optionTitle").innerText.replace("\n",""),r=e.closest(".cardOption").querySelector(".card-text > img").src,a=parseFloat(e.closest(".cardOption").querySelector(".priceOption").innerText.replace("R$","").replace(",","."));document.querySelector(".insertOption");return o.preventDefault(),$("#options").on("hidden.bs.modal",function(e){$("#formOptions").modal("show"),$(this).off("hidden.bs.modal")}),$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show")}),setFormEditOption(t,{name:n,image:r,price:a})})},deleteOption=e=>{const t=e.dataset.id;update(1),fetch(`${URL}/api/option/${t}`,{method:"DELETE",headers:{"content-type":"application/json"}}).then(e=>e.json()).then(t=>{update(()=>{e.closest(".option").remove()})}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},clickRemoveOption=e=>{e.addEventListener("click",t=>{t.preventDefault(),deleteOption(e)})},showOptions=e=>{update(1,"dark"),fetch(`${URL}/api/option?custom=${e}`).then(e=>e.json()).then(e=>{update(()=>{document.querySelector(".modal.options .modal-title").innerHTML=e.name,document.querySelector(".modal.formOptions .modal-title").innerHTML=`Adicionar ${e.name}`;const{options:t}=e;if(document.querySelector(".optionsContainer").innerHTML="",!t.length)return document.querySelector(".optionsContainer").innerHTML="Não há opções dacastradas para esta customização";t.forEach(e=>{const t=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.price);let o=document.createElement("div");return o.classList.add("col-6","col-lg-4","option"),o.innerHTML=`\n                     <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                    \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                        <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="card-body text-primary">\n                            <p class="card-text">\n                                <img src="${e.image}" class="img-thumbnail">\n                            </p>\n                        </div>\n                        <div class="card-footer bg-transparent">\n                            <a href="#" class="btn btn-primary priceOption">${t}</a>\n                        </div>\n                     </div>`,clickRemoveOption(o.querySelector(".card-header .btn-danger")),clickUpdateOption(o.querySelector(".card-header .editOption")),document.querySelector(".optionsContainer").append(o)})},"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},InsertOption=e=>{const t=document.querySelector(".optionName"),o=document.querySelector(".optionImage"),n=document.querySelector(".optionPrice"),r=document.createElement("div");if(r.classList.add("col-6","col-lg-4","option"),!t.value)return t.setCustomValidity("Informe um nome para esta opção"),t.reportValidity();if(!o.value)return o.setCustomValidity("Informe a url da imagem"),o.reportValidity();if(!n.value)return n.setCustomValidity("Informe um preço para esta opção"),n.reportValidity();const a={customization_id:e,name:t.value,image:o.value,price:parseFloat(n.value)};document.querySelectorAll(".optionsContainer > div").length||(document.querySelector(".optionsContainer").innerHTML=""),update(1),fetch(`${URL}/api/option`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{update(()=>{const t=Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.price);return r.innerHTML=`\n                  <div class="card border-primary mb-3 cardOption" data-id="${e.id}">\n                        <div class="card-header">\n                            <div class="row">\n                                <div class="col-6 optionTitle">\n                                    ${e.name} \n                                </div>\n                                <div class="col-6 ml-auto">\n                                    <button class="btn btn-primary btn-sm editOption" data-dismiss="modal" data-id="${e.id}" type="submit">\n                                       <i class="fas fa-edit"></i>\n                                    </button>\n                                 \n                                    <button class="btn btn-danger btn-sm" data-id="${e.id}" type="submit">\n                                          <i class="far fa-trash-alt"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                          <div class="card-body text-primary">\n                              <p class="card-text">\n                                  <img src="${e.image}" class="img-thumbnail">\n                              </p>\n                          </div>\n                          <div class="card-footer bg-transparent">\n                             <a href="#" class="btn btn-primary priceOption">${t}</a>\n                          </div>\n                  </div>`,document.querySelector(".optionsContainer").prepend(r),clickRemoveOption(r.querySelector(".card-header .btn-danger")),clickUpdateOption(r.querySelector(".card-header .editOption")),$("#formOptions").modal("hide"),document.querySelector(".insertOption").dataset.insert=!1,$("#formOptions").on("hidden.bs.modal",function(e){$("#options").modal("show"),$(this).off("hidden.bs.modal")})})}).catch(e=>(update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})}),console.log(e)))},btnSaveOption=document.querySelector(".saveOption");btnSaveOption.addEventListener("click",e=>{if(e.preventDefault(),btnSaveOption.dataset.editId)return updateOption();InsertOption(document.querySelector(".insertOption").dataset.option)});const vtexAccountName="woodprime",vtexEnvironment="vtexcommercestable",getVtexProduct=e=>{if(!e.value)return alert("Informe o sku do produto");const t=e.value;new Headers({Host:"*"});fetch(`https://woodprime.vtexcommercestable.com.br/api/catalog_system/pvt/sku/stockkeepingunitbyid/skuId${t}`,{method:"GET",headers:{"content-type":"application/json",accept:"application/json"}}).then(e=>e.json()).then(e=>{console.log(e)}).catch(e=>console.log(e))},putValues=e=>{const{name:t,code:o}=e;document.querySelector(".nameProduct").value=t,document.querySelector(".codeProduct").value=o},btnSearchProduct=document.querySelector(".btnGetProductVtex");btnSearchProduct.addEventListener("click",e=>{e.preventDefault();document.querySelector(".skuProduct");return putValues({name:"Produto Teste",code:"6277"})});const productResource="product",requestProduct=e=>{const{name:t,code:o,description:n,image:r}=e;update(1,"dark"),fetch(`${URL}/api/product`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,code:o,description:n,image:r})}).then(e=>e.json()).then(e=>{update(()=>{Swal.fire({title:`Produto ${e.name} cadastrado`,icon:"success",showCloseButton:!0})},"dark")})},insertProduct=()=>{const e=document.querySelector(".nameProduct"),t=document.querySelector(".codeProduct"),o=document.querySelector(".descriptionProduct"),n=document.querySelector(".imageProduct");return e.value?t.value?o.value?n.value?console.log({name:e.value,code:t.value,description:o.value,image:n.value}):(n.setCustomValidity("Informe o nome do produto"),n.reportValidity()):(o.setCustomValidity("Informe o nome do produto"),o.reportValidity()):(t.setCustomValidity("Informe o nome do produto"),t.reportValidity()):(e.setCustomValidity("Informe o nome do produto"),e.reportValidity())},buttonInsert=document.querySelector(".insertProduct");buttonInsert.addEventListener("click",e=>{e.preventDefault(),insertProduct()});const typeResource="type",tabTypeInsert=e=>{const t=document.createElement("a"),{id:o,name:n}=e;t.classList.add("list-group-item","list-group-item-action"),t.setAttribute("id",`list-type-${o}-list`),t.setAttribute("role","tab"),t.setAttribute("aria-selected","false"),t.setAttribute("aria-controls",`list-type-${o}`),t.setAttribute("href",`#list-type-${o}`),t.dataset.toggle="list",t.innerHTML=n;const r=document.createElement("div");r.classList.add("tab-pane","fade"),r.setAttribute("id",`list-type-${o}`),r.setAttribute("role","tabpanel"),r.setAttribute("aria-labelledby",`list-type-${o}-list`);const a=()=>{const e=document.createElement("div");return e.classList.add("row"),e.innerHTML=`<div class="col-12">\n         <nav aria-label="..." class="paginate-type-${o}" data-resource="type">\n            <ul class="pagination">\n            <li class="page-item disabled">\n               <span class="page-link">Previous</span>\n            </li>\n            <li class="page-item active" aria-current="page">\n               <span class="page-link">\n                  1\n                  <span class="sr-only">(current)</span>\n               </span>\n            </li>\n            <li class="page-item">\n               <a class="page-link" href="#">Next</a>\n            </li>\n            </ul>\n         </nav>\n      </div> \x3c!-- Paginação // --\x3e`,e},i=document.createElement("div");return i.classList.add("row",`container-type-${o}`),document.querySelector(".tabContentTypes").append(r),r.append(a()),r.append(i),r.append(a()),document.querySelector(".tabTypes").append(t)},tabTypeRemove=e=>{document.querySelector(`#list-type-${e}-list`).remove(),document.querySelector(`#list-type-${e}`).remove()},insertType=e=>{if(!e.value)return alert("Informe o nome do tipo de customização");update(1,"dark"),fetch(`${URL}/api/type`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:e.value})}).then(t=>{update(2,"dark"),t.json().then(t=>{const o=document.createElement("div");return o.classList.add("card","mb-3","card-type"),o.id=`type-${t.id}`,o.style.flex="0 0 calc(33.333333% - 10px)",o.style.margin="0 5px",o.innerHTML=`<div class="card-body text-center">\n                <h6 class="card-title mb-0">${t.name}</h6>\n              </div>\n              <div class="types-hover">\n                <button type="button" class="btn btn-danger del-type" data-delete="#type-${t.id}">\n                  <i class="fas fa-trash-alt"></i>\n                </button>\n                <button type="button" class="btn btn-success select-type" data-dismiss="modal" type-id="${t.id}" data-select="#type-${t.id}">\n                  <i class="fas fa-check"></i>\n                </button>\n              </div>`,e.value="",update(()=>{document.querySelector(".typesContainer").prepend(o),o.querySelector(".select-type").addEventListener("click",e=>{e.preventDefault(),console.log("selecionei"),selectType(o.querySelector(".select-type"))}),tabTypeInsert({id:t.id,name:t.name});const e=o.querySelector(".del-type");return e.addEventListener("click",t=>{t.preventDefault(),deleteType(e)})},"dark")}).catch(e=>console.log(e))}).catch(e=>{console.log(e)})},btnInsertType=document.querySelector(".insertType");btnInsertType.addEventListener("click",e=>{e.preventDefault(),insertType(document.querySelector(".typeName"))});const deleteType=e=>{const t=parseInt(e.getAttribute("data-delete").replace("#type-",""));update(1,"dark"),fetch(`${URL}/api/type/${t}`,{method:"DELETE"}).then(o=>{update(2,"dark"),o.json().then(o=>update(()=>(tabTypeRemove(t),document.querySelector(e.getAttribute("data-delete")).remove()),"dark")).catch(e=>console.log(e))}).catch(e=>{console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})},"dark")})},btnDeleteType=document.querySelectorAll(".del-type");Array.from(btnDeleteType).forEach(e=>{e.addEventListener("click",t=>(t.preventDefault(),deleteType(e)))});const selectType=e=>{const t=e.getAttribute("type-id");document.querySelector(".typeCustom").value=t;const o=e.closest(".card-type").querySelector(".card-title");return document.querySelector(".btn-modal-types").classList.remove("btn-primary"),document.querySelector(".btn-modal-types").classList.add("btn-success"),document.querySelector(".btn-modal-types").innerHTML=o.innerHTML};let btnSelect=document.querySelectorAll(".select-type");Array.from(btnSelect).forEach(e=>{e.addEventListener("click",function(t){selectType(e)})});const customUpdate=e=>{const{id:t,name:o,description:n,type_id:r}=e;update(1,"dark"),fetch(`${URL}/api/custon/${t}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({name:o,description:n,type_id:r})}).then(e=>{update(()=>(console.log(e),$("#modalUnrelated").modal("hide")),"dark")}).catch(e=>(console.log(e),update(()=>{Swal.fire({title:"Tivemos um erro de sistema",icon:"error",showCloseButton:!0})})))},editCustom=()=>{const e=document.querySelectorAll(".unrelatedCustom");document.querySelector(".editCustomForm").addEventListener("submit",e=>{e.preventDefault();const t={id:document.querySelector(".unrelatedCustomId").value,name:document.querySelector("#ulName").value,description:document.querySelector("#ulDescription").value,type_id:parseInt(document.querySelector("#ulTypeId").value)};return customUpdate(t)}),Array.from(e).forEach(e=>{e.addEventListener("click",t=>{const o=e.dataset.id,n=e.querySelector(".unrelatedName").innerHTML,r=e.querySelector(".unrelatedDescription").innerHTML;document.querySelector(".unrelatedCustomId").value=o,document.querySelector("#ulName").value=n,document.querySelector("#ulDescription").value=r,$("#modalUnrelated").modal("show")})})};editCustom();